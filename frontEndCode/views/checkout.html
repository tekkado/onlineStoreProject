<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>mCubed Cart</title>
    <link href="../css/style.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <!-- Header section -->
    <header>
        <nav id="navbar-container">
            <!-- Navbar will be inserted here -->
        </nav>
    </header>

    <!-- Main content section -->
    <main class="checkout-main">
        <h1 class="checkout-title">Checkout</h1>
        <div class="checkout-section">
            <div class="checkout-form">
                <!-- Shipping Address section -->
                <div class="shipping-form">
                    <h2 class="center-text">Shipping Address</h2>
                    <label for="street">Street</label>
                    <input type="text" id="street" name="street" class="input-field" required />
                    <label for="province">Province</label>
                    <input type="text" id="province" name="province" class="input-field" required />
                    <label for="country">Country</label>
                    <input type="text" id="country" name="country" class="input-field" required />
                    <label for="zip">ZIP</label>
                    <input type="text" id="zip" name="zip" class="input-field" required />
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" name="phone" class="input-field" required />
                </div>

                <!-- Payment Method section -->
                <div class="billing-form">
                    <h2 class="center-text">Payment Method</h2>
                    <label for="card-number">Card Number</label>
                    <input type="text" id="card-number" name="card-number" class="input-field" required />
                    <p id="card-error" class="error-message">
                        Sorry, this Card Number is not valid.
                    </p>
                </div>

                <div class="fix-button">
                    <button type="submit" class="signup-button" id="confirm-order-button">
                        Confirm Order
                    </button>
                </div>
            </div>

            <div class="product-section">
                <div class="total-price">
                    <h2 class="center-text">
                        Total Price: <span id="total-price-value">$0.00</span>
                    </h2>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="cart-products">
                        <!-- Cart products will be displayed here -->
                    </tbody>
                </table>
                <div class="fix-button">
                    <a href="../views/cart.html" class="signup-button">Back to Cart</a>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div id="footer-container">
            <!-- Footer will be inserted here -->
        </div>
    </footer>

    <script src="../js/userFuncs.js" type="text/javascript"></script>
    <script>
        const cartItems = JSON.parse(localStorage.getItem("cart")) || [];
        const totalPriceValue = document.getElementById("total-price-value");

        function populateCheckoutTable() {
            const cartTableBody = document.getElementById("cart-products");

            cartItems.forEach((item) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                        <td>${item.name}</td>
                        <td>${item.quantity}</td>
                        <td>${item.price}</td>
                        <td>${(item.price * item.quantity).toFixed(2)}</td>
                    `;
                cartTableBody.appendChild(row);
            });
            updateTotalPrice();
        }

        window.onload = populateCheckoutTable;

        function validateCardNumber(cardNumber) {
            return /^\d{16}$/.test(cardNumber);
        }

        const cardNumberInput = document.getElementById("card-number");
        const confirmOrderButton = document.getElementById(
            "confirm-order-button"
        );
        const cardError = document.getElementById("card-error");

        confirmOrderButton.addEventListener("click", function (event) {
            event.preventDefault();
            cardError.style.display = "none";

            const isValidCardNumber = validateCardNumber(cardNumberInput.value);

            if (!isValidCardNumber) {
                cardError.style.display = "block";
            } else {
                window.location.href = "../html/index.html?orderSuccess=true";
            }
        });

        cardNumberInput.addEventListener("input", function () {
            const isValidCardNumber = validateCardNumber(cardNumberInput.value);

            if (isValidCardNumber) {
                cardError.style.display = "none";
            }
        });

        function updateTotalPrice() {
            const totalPrice = cartItems.reduce(
                (total, item) => total + item.price * item.quantity,
                0
            );
            totalPriceValue.textContent = `$${totalPrice.toFixed(2)}`;
        }
    </script>

</body>

</html>